<!--
MEOS (Mock) - KMar
GitHub Pages friendly single-file HTML for a mock MEOS (Melding- en Eenheid-Operationsysteem)
Author: Milo (assistant)
Notes:
- This is a front-end only prototype (no server). Data is stored in browser localStorage.
- Suitable to commit to a GitHub repo and enable GitHub Pages.
- Replace branding, endpoints and storage with a backend when integrating with real systems.

Usage:
- Open the file in a browser or publish via GitHub Pages.
- Use the login form (any username) to start a session.

Features:
- Modern dark/light theme with black/white aesthetic
- Login modal (local only)
- Incident list with add/edit/delete and quick filters
- Export/Import JSON for persistence or sharing
- Simulated map placeholder for future integration
- Accessible, responsive layout
-->

<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MEOS — KMar (Prototype)</title>
  <meta name="description" content="Prototype MEOS voor KMar — meldingensysteem (frontend-only)." />
  <style>
    /* Minimal reset */
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}

    :root{
      --bg:#0b0b0b; /* deep black */
      --panel:#0f0f0f; /* slightly lighter */
      --muted:#9aa0a6;
      --accent:#c6c6c6; /* light grey accent */
      --success:#6fcf97;
      --danger:#ff6b6b;
      --glass: rgba(255,255,255,0.03);
      --radius:12px;
    }

    body{background:linear-gradient(180deg,var(--bg), #070707);color:var(--accent);padding:16px}
    .app{max-width:1100px;margin:20px auto}

    header{display:flex;align-items:center;gap:16px}
    .brand{display:flex;flex-direction:column}
    .brand h1{margin:0;font-size:20px;color:#fff}
    .brand p{margin:0;font-size:12px;color:var(--muted)}

    .top-actions{margin-left:auto;display:flex;gap:8px}
    button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:10px;color:var(--accent);cursor:pointer}
    button.primary{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08)}

    main{display:grid;grid-template-columns:360px 1fr;gap:18px;margin-top:18px}

    .sidebar{background:var(--panel);padding:14px;border-radius:var(--radius);min-height:420px}
    .card{background:var(--panel);padding:12px;border-radius:12px}

    .search input{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--accent)}

    .filters{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
    .chip{padding:6px 8px;border-radius:8px;font-size:13px;border:1px solid rgba(255,255,255,0.03)}

    .inc-list{margin-top:12px;display:flex;flex-direction:column;gap:10px}
    .inc{padding:10px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.02);display:flex;justify-content:space-between;align-items:flex-start}
    .inc h3{margin:0;font-size:14px;color:#fff}
    .meta{font-size:12px;color:var(--muted)}

    .details{background:var(--panel);padding:14px;border-radius:var(--radius);min-height:420px}
    .toolbar{display:flex;gap:8px;align-items:center}

    .form-row{display:flex;gap:8px;margin-top:8px}
    input[type=text], textarea, select{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--accent)}
    textarea{min-height:88px}

    footer{margin-top:14px;color:var(--muted);font-size:13px}

    /* modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center}
    .modal{background:linear-gradient(180deg,#0d0d0d,#0b0b0b);padding:18px;border-radius:16px;width:420px;box-shadow:0 10px 30px rgba(0,0,0,0.6)}

    @media (max-width:900px){main{grid-template-columns:1fr;}.sidebar{order:2}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <h1>MEOS — KMar</h1>
        <p>Prototype meldingen- & operationsysteem</p>
      </div>

      <div class="top-actions">
        <button id="importBtn">Import JSON</button>
        <button id="exportBtn" class="primary">Export JSON</button>
        <button id="loginBtn">Login</button>
      </div>
    </header>

    <main>
      <aside class="sidebar card">
        <div class="search">
          <input id="search" placeholder="Zoek incident, locatie of roepnummer..." />
        </div>

        <div class="filters">
          <div class="chip" data-filter="all">Alle</div>
          <div class="chip" data-filter="open">Open</div>
          <div class="chip" data-filter="ongoing">In uitvoering</div>
          <div class="chip" data-filter="closed">Afgesloten</div>
          <div class="chip" data-filter="urgent">Urgent</div>
        </div>

        <div class="inc-list" id="incList">
          <!-- incidents inserted here -->
        </div>

        <div style="margin-top:12px;display:flex;gap:8px">
          <button id="newInc">Nieuw melding</button>
          <button id="clearAll">Wis alles</button>
        </div>
      </aside>

      <section class="details card" id="details">
        <div class="toolbar">
          <h2 id="detailsTitle">Selecteer een melding</h2>
        </div>

        <div id="detailBody" style="margin-top:12px;color:var(--muted)">
          Geen melding geselecteerd. Klik op "Nieuw melding" om een te maken.
        </div>

        <div style="margin-top:12px;display:flex;gap:8px">
          <button id="editBtn">Bewerk</button>
          <button id="closeBtn">Sluit melding</button>
        </div>

        <footer>
          Prototype — niet voor operationeel gebruik. Vervang opslag en authenticatie met echte services.
        </footer>
      </section>
    </main>
  </div>

  <!-- Modal: Login / Create Incident / Edit -->
  <div class="modal-backdrop" id="modal">
    <div class="modal" role="dialog" aria-modal="true">
      <div id="modalContent">
        <!-- dynamic content -->
      </div>
    </div>
  </div>

  <script>
    // Simple app state
    const storageKey = 'meos_kmar_v1';
    let state = {user:null, incidents:[] , selectedId: null};

    // Utilities
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    function load(){
      try{ const raw = localStorage.getItem(storageKey); if(raw) state = JSON.parse(raw); else save(); }
      catch(e){ console.error('load error',e); }
    }
    function save(){ localStorage.setItem(storageKey, JSON.stringify(state)); render(); }

    // Render
    function render(){
      // user
      $('#loginBtn').textContent = state.user ? (state.user+' • Logout') : 'Login';

      // incidents list
      const list = $('#incList'); list.innerHTML = '';
      const q = $('#search').value.toLowerCase();
      const filter = document.querySelector('.chip.active')?.dataset.filter || 'all';

      state.incidents.filter(i => {
        if(filter==='all') return true;
        if(filter==='open') return i.status==='open';
        if(filter==='ongoing') return i.status==='ongoing';
        if(filter==='closed') return i.status==='closed';
        if(filter==='urgent') return !!i.urgent;
        return true;
      }).filter(i => {
        if(!q) return true;
        return (i.title+i.location+i.callSign+i.description).toLowerCase().includes(q);
      }).forEach(i => {
        const el = document.createElement('div'); el.className='inc'; el.dataset.id=i.id;
        el.innerHTML = `
          <div>
            <h3>${escapeHtml(i.title)}</h3>
            <div class="meta">${i.callSign || '—'} • ${i.location || 'onbekend'} • ${i.time}</div>
          </div>
          <div style="text-align:right">
            <div class="meta">${i.status}</div>
            <div style="margin-top:8px"><button data-action="open">Open</button></div>
          </div>
        `;
        el.querySelector('button[data-action=open]').addEventListener('click',()=>selectIncident(i.id));
        list.appendChild(el);
      });

      // details
      renderDetails();
    }

    function renderDetails(){
      const title = $('#detailsTitle'); const body = $('#detailBody');
      const i = state.incidents.find(x=>x.id===state.selectedId);
      if(!i){ title.textContent='Selecteer een melding'; body.textContent='Geen melding geselecteerd. Klik op "Nieuw melding" om een te maken.'; return }
      title.textContent = i.title;
      body.innerHTML = `
        <div><strong>Roepnummer:</strong> ${escapeHtml(i.callSign||'—')}</div>
        <div><strong>Status:</strong> ${i.status}</div>
        <div style="margin-top:8px"><strong>Locatie:</strong> ${escapeHtml(i.location||'—')}</div>
        <div style="margin-top:8px"><strong>Tijd:</strong> ${i.time}</div>
        <div style="margin-top:12px"><strong>Beschrijving</strong><p style="color:var(--accent)">${escapeHtml(i.description||'—')}</p></div>
      `;
    }

    function selectIncident(id){ state.selectedId = id; save(); }

    // small helpers
    function uid(){ return 'id_'+Math.random().toString(36).slice(2,9); }
    function now(){ return new Date().toLocaleString('nl-NL'); }
    function escapeHtml(s){ if(!s && s!==0) return ''; return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }

    // Modal helpers
    function showModal(contentHtml){ $('#modalContent').innerHTML = contentHtml; $('#modal').style.display='flex'; }
    function hideModal(){ $('#modal').style.display='none'; $('#modalContent').innerHTML=''; }

    // Actions
    $('#loginBtn').addEventListener('click', ()=>{
      if(state.user){ state.user=null; save(); return }
      showModal(`
        <h3>Login</h3>
        <div style="margin-top:8px"><label>Gebruikersnaam</label><input id="loginUser" type="text" /></div>
        <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end"><button id="cancelLogin">Annuleren</button><button id="doLogin" class="primary">Login</button></div>
      `);
      $('#cancelLogin').addEventListener('click',hideModal);
      $('#doLogin').addEventListener('click', ()=>{ const u = $('#loginUser').value.trim(); if(!u) return alert('Vul een gebruikersnaam in'); state.user=u; save(); hideModal(); });
    });

    $('#newInc').addEventListener('click', ()=>{
      showModal(`
        <h3>Nieuwe melding</h3>
        <div class="form-row"><input id="m_title" placeholder="Titel (bijv. Verdachte situatie)" /></div>
        <div class="form-row"><input id="m_call" placeholder="Roepnummer (bijv. KMar001)" /></div>
        <div class="form-row"><input id="m_loc" placeholder="Locatie" /></div>
        <div class="form-row"><select id="m_status"><option value="open">open</option><option value="ongoing">in uitvoering</option><option value="closed">afgesloten</option></select></div>
        <div class="form-row"><textarea id="m_desc" placeholder="Beschrijving..."></textarea></div>
        <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end"><button id="cancelNew">Annuleren</button><button id="saveNew" class="primary">Opslaan</button></div>
      `);
      $('#cancelNew').addEventListener('click', hideModal);
      $('#saveNew').addEventListener('click', ()=>{
        const newInc = { id:uid(), title:$('#m_title').value||'Onbekende melding', callSign:$('#m_call').value, location:$('#m_loc').value, status:$('#m_status').value, description:$('#m_desc').value, time:now(), urgent:false };
        state.incidents.unshift(newInc); state.selectedId=newInc.id; save(); hideModal();
      });
    });

    $('#clearAll').addEventListener('click', ()=>{ if(confirm('Weet je het zeker? Alle meldingen worden verwijderd.')){ state.incidents=[]; state.selectedId=null; save(); } });

    $('#exportBtn').addEventListener('click', ()=>{
      const data = JSON.stringify(state, null, 2);
      const blob = new Blob([data],{type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='meos_kmar_export.json'; a.click(); URL.revokeObjectURL(url);
    });

    $('#importBtn').addEventListener('click', ()=>{
      showModal(`
        <h3>Import JSON</h3>
        <div><input id="fileInput" type="file" accept="application/json" /></div>
        <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end"><button id="cancelImp">Annuleren</button><button id="doImport" class="primary">Importeer</button></div>
      `);
      $('#cancelImp').addEventListener('click', hideModal);
      $('#doImport').addEventListener('click', ()=>{
        const f = $('#fileInput').files?.[0]; if(!f) return alert('Kies een JSON bestand');
        const reader = new FileReader(); reader.onload = e=>{
          try{ const imported = JSON.parse(e.target.result); if(imported.incidents) state = imported; else alert('Ongeldig bestand'); save(); hideModal(); } catch(err){ alert('Fout bij lezen JSON'); }
        }; reader.readAsText(f);
      });
    });

    // chips
    $$('.chip').forEach(c=>c.addEventListener('click', e=>{ $$('.chip').forEach(x=>x.classList.remove('active')); c.classList.add('active'); render(); }));
    $('#search').addEventListener('input', ()=>render());

    // edit/close
    $('#editBtn').addEventListener('click', ()=>{
      const i = state.incidents.find(x=>x.id===state.selectedId); if(!i) return alert('Geen melding geselecteerd');
      showModal(`
        <h3>Melding bewerken</h3>
        <div class="form-row"><input id="e_title" value="${escapeHtml(i.title)}" /></div>
        <div class="form-row"><input id="e_call" value="${escapeHtml(i.callSign)}" /></div>
        <div class="form-row"><input id="e_loc" value="${escapeHtml(i.location)}" /></div>
        <div class="form-row"><select id="e_status"><option value="open">open</option><option value="ongoing">in uitvoering</option><option value="closed">afgesloten</option></select></div>
        <div class="form-row"><textarea id="e_desc">${escapeHtml(i.description)}</textarea></div>
        <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end"><button id="cancelEdit">Annuleren</button><button id="saveEdit" class="primary">Opslaan</button></div>
      `);
      $('#e_status').value = i.status;
      $('#cancelEdit').addEventListener('click', hideModal);
      $('#saveEdit').addEventListener('click', ()=>{
        i.title = $('#e_title').value; i.callSign = $('#e_call').value; i.location = $('#e_loc').value; i.status = $('#e_status').value; i.description = $('#e_desc').value; i.time = now(); save(); hideModal();
      });
    });

    $('#closeBtn').addEventListener('click', ()=>{
      const i = state.incidents.find(x=>x.id===state.selectedId); if(!i) return alert('Geen melding geselecteerd'); i.status='closed'; i.time=now(); save();
    });

    // initial load
    load(); render();

    // seed sample data if empty
    if(state.incidents.length===0){
      state.incidents.push({id:uid(), title:'Verdacht voertuig', callSign:'KMar-07', location:'N50.814, E4.526', status:'open', description:'Getuigen zien voertuig met onbekende koers bij grenspost.', time:now(), urgent:true});
      state.incidents.push({id:uid(), title:'Ongeval A4', callSign:'KMar-12', location:'A4 rijrichting zuid', status:'ongoing', description:'Botsing tussen twee voertuigen; assistentie nodig.', time:now(), urgent:false});
      save();
    }

    // close modal on backdrop click
    document.getElementById('modal').addEventListener('click', (e)=>{ if(e.target.id==='modal') hideModal(); });

  </script>
</body>
</html>
